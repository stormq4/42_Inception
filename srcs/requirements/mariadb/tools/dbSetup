#!bin/bash

set -x

echo "starting deamon"

/usr/sbin/mysqld --user=mysql --skip-networking --default-time-zone=SYSTEM --wsrep_on=OFF \
		--expire-logs-days=0 \
		--loose-innodb_buffer_pool_load_at_startup=0 
#>/dev/null &
MDB_PID=$!

echo "this is PID: $MDB_PID"

sleep 4

cat > /tmp/dbSetup.sql << STOP
USE mysql;
CREATE DATABASE IF NOT EXISTS $WP_DB_NAME;
CREATE USER IF NOT EXISTS '$WP_USER'@'%' IDENTIFIED BY '$WP_PASSWORD';
CREATE USER IF NOT EXISTS '$WP_ADMIN_USER'@'%' IDENTIFIED BY '$WP_ADMIN_PASSWORD';
GRANT ALL PRIVILEGES ON *.* TO '$WP_ADMIN_USER'@'%' WITH GRANT OPTION;
ALTER USER 'root'@'localhost' IDENTIFIED BY '$ROOT_PW';
FLUSH PRIVILEGES;
STOP

mysql < /tmp/dbSetup.sql > /devnull

# kill $MDB_PID
# wait $MDB_PID
# echo "stopping deamon"
# mysqld --user=mysql --bootstrap < /tmp/dbSetup.sql
# exec /usr/sbin/mysqld --user=mysql --console > /dev/null