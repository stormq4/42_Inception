#!bin/bash

mkdir -p /var/run/mysqld
chown -R mysql:mysql /var/run/mysqld
chown -R mysql:mysql /var/lib/mysql

mysql_install_db

sudo service mysql stop

cat > /tmp/dbSetup.sql << STOP
CREATE DATABASE IF NOT EXISTS WORDPRESS;
CREATE USER IF NOT EXISTS '$WP_USER'@'%' IDENTIFIED BY '$WP_PASSWORD';
CREATE USER IF NOT EXISTS '$WP_ADMIN_USER'@'%' IDENTIFIED BY '$WP_ADMIN_PASSWORD';
GRANT ALL PRIVILEGES ON *.* TO '$WP_ADMIN_USER'@'%' WITH GRANT OPTION;
DELETE FROM mysql.user WHERE User='root';
FLUSH PRIVILEGES;
STOP

sudo service mysql start && mysql < /tmp/dbSetup.sql

sudo mysqladmin -u$WP_ADMIN_USER -p$WP_ADMIN_PASSWORD shutdown
rm -f /tmp/wpdbscript.sql

mysqld
