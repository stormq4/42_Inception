#!bin/bash

if [ ! -d /run/myslqd ]
then
	mkdir -p /var/run/mysqld
	chown -R mysql:mysql /var/run/mysqld
	chown -R mysql:mysql /var/lib/mysql

	mysql_install_db --basedir=/usr --datadir=/var/lib/mysql

	service mysql stop

	echo "test 2"

cat > /tmp/dbSetup.sql << STOP
USE mysql;
FLUSH PRIVILEGES;
CREATE DATABASE IF NOT EXISTS WORDPRESS;
CREATE USER IF NOT EXISTS '$WP_USER'@'%' IDENTIFIED BY '$WP_PASSWORD';
CREATE USER IF NOT EXISTS '$WP_ADMIN_USER'@'%' IDENTIFIED BY '$WP_ADMIN_PASSWORD';
GRANT ALL PRIVILEGES ON *.* TO '$WP_ADMIN_USER'@'%' WITH GRANT OPTION;
DELETE FROM mysql.user WHERE User='root';
STOP

	echo "test 1"


	mysqld --user=mysql --bootstrap < /tmp/dbSetup.sql

fi
# service mysql start && mysql < /tmp/dbSetup.sql

# mysqladmin -u$WP_ADMIN_USER -p$WP_ADMIN_PASSWORD
# # mysqladmin -u$WP_ADMIN_USER -p$WP_ADMIN_PASSWORD shutdown
# # rm -f /tmp/wpdbscript.sql

# mysqld
# mysqladmin -h${MDB_NAME} -u${WP_USER} -p${WP_PASSWORD} ping
exec mysqld --user=mysql --console